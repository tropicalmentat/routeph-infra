---
- name: Configure DB for backend
  hosts: database:api
  remote_user: rowt_admin
  become: yes

  tasks:
          - debug:
                  var: hostvars['db']['ansible_facts']['eth0']['ipv4']['address']
            when: "'api' in inventory_hostname"

          - name: Allow API server to access db
            postgresql_pg_hba:
                    dest: /etc/postgresql/12/main/pg_hba.conf
                    contype: host
                    users: rowt_admin
                    source: "{{ hostvars['api']['ansible_facts']['eth0']['ipv4']['address'] }}/32"
                    databases: rowt_db
                    method: md5
            when: "'db' in inventory_hostname"
